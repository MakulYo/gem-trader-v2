<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TSDGEMS - Diamond Trading Simulator</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
    .hidden { display: none !important; }
    #nav-wallet[data-auth="signed-out"] #wallet-balance { display: none !important; }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-gem"></i>
                <span>TSDGEMS</span>
            </div>
            
            <!-- Mobile Menu Toggle -->
            <button class="mobile-menu-toggle" id="mobile-menu-toggle">
                <i class="fas fa-bars"></i>
            </button>
            
            <div class="nav-menu" id="nav-menu">
                <a href="#dashboard" class="nav-link active">Dashboard</a>
                <a href="#mining" class="nav-link">Mining</a>
                <a href="#polishing" class="nav-link">Polishing</a>
                <a href="#trading" class="nav-link">Trading</a>
            </div>

            <div class="nav-wallet" id="nav-wallet" data-auth="signed-out">
              <span id="wallet-address" class="wallet-address hidden" title="Wallet address"></span>
              <span id="wallet-balance" class="wallet-balance hidden" data-token="TSD">0.00 TSD</span>

              <button id="connect-wallet" class="connect-wallet-btn" data-action="connect">
                  Connect Wallet
              </button>

              <button id="disconnect-wallet" class="connect-wallet-btn hidden" data-action="disconnect">
                  Disconnect
              </button>
            </div>

            <!-- Choose Wallet Modal -->
            <div id="wallet-modal" class="modal-overlay hidden" aria-hidden="true">
              <div class="modal">
                <div class="modal-header">
                  <h3>Connect Wallet</h3>
                  <button class="modal-close" data-close-wallet-modal>
                      <i class="fas fa-times"></i>
                  </button>
                </div>
                <div class="modal-body">
                  <div class="wallet-grid">
                      <button class="action-btn primary" data-provider="cloud">
                        <i class="fas fa-cloud"></i> WAX Cloud Wallet
                      </button>
                      <button class="action-btn secondary" data-provider="anchor">
                        <i class="fas fa-anchor"></i> Anchor
                      </button>
                      <button class="action-btn tertiary" data-provider="wombat" disabled title="Coming soon">
                        <i class="fas fa-paw"></i> Wombat (coming soon)
                      </button>
                  </div>
                  <p id="wallet-error" class="text-danger hidden"></p>
                </div>
              </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Dashboard Section -->
        <section id="dashboard" class="section active">
            <div class="dashboard-header">
                <h1>Welcome to TSDGEMS</h1>
                <p>The ultimate blockchain-based diamond trading simulator</p>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-coins"></i>
                    </div>
                    <div class="stat-content">
                        <h3>Ingame $</h3>
                        <p class="stat-value" id="tsd-balance">0.00</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-content">
                        <h3>Hired Workers</h3>
                        <p class="stat-value" id="active-workers">0</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-map-marker-alt"></i>
                    </div>
                    <div class="stat-content">
                        <h3>Mining Slots</h3>
                        <p class="stat-value" id="mining-slots-count">0/10</p>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-wallet"></i>
                    </div>
                    <div class="stat-content">
                        <h3>TSDM Balance</h3>
                        <p class="stat-value" id="tsdm-balance">0.00</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Mining Section -->
        <section id="mining" class="section">
            <div class="section-header">
                <h2>Mining Operations</h2>
                <p>Manage your mining infrastructure and equipment</p>
            </div>

            <div class="mining-container">
                <div class="mining-slots-grid">
                    <div class="mining-overview">
                        <div class="mining-stats">
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-mountain"></i>
                                </div>
                                <div class="stat-content">
                                    <h3>Active Mining Sites</h3>
                                    <p class="stat-value" id="active-mining-sites">0</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="stat-content">
                                    <h3>Workforce</h3>
                                    <p class="stat-value" id="total-workforce">0</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mining-slots-section">
                        <div class="section-title">
                            <h3><i class="fas fa-gem"></i> Mining Properties</h3>
                            <p>Discover, acquire, and develop profitable mining locations</p>
                        </div>
                        <div class="slots-grid" id="slots-grid">
                            <!-- Mining slots will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Polishing Section -->
        <section id="polishing" class="section">
            <div class="section-header">
                <h2>Gem Polishing</h2>
                <p>Stake polishing table NFTs and polish gems in automated slots</p>
            </div>

            <div class="polishing-container">
                <div class="polishing-overview">
                    <div class="polishing-stats">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-gem"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Total Polished Gems</h3>
                                <p class="stat-value" id="polished-gems-count">0</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Total Rewards Earned</h3>
                                <p class="stat-value" id="polishing-rewards">0</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-box"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Gem Inventory</h3>
                                <p class="stat-value" id="total-inventory-gems">0</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="polishing-slots">
                    <div class="section-title">
                        <h3><i class="fas fa-table"></i> Polishing Slot System</h3>
                        <p>Stake Polishing Table NFTs in slots and polish gems automatically</p>
                    </div>
                    
                    <div class="slots-grid" id="polishing-slots-grid">
                        <!-- Polishing slots will be populated by JavaScript -->
                    </div>
                </div>

                <div class="gem-inventory" id="gem-inventory">
                    <div class="section-title">
                        <h3><i class="fas fa-gem"></i> Gem Distribution Table</h3>
                        <p>Chance distribution for obtaining gems through polishing</p>
                    </div>
                    
                    <div class="distribution-table">
                        <table class="gem-distribution-table">
                            <thead>
                                <tr>
                                    <th>Gem Type</th>
                                    <th>Chance</th>
                                    <th>Owned</th>
                                    <th>Rarity</th>
                                </tr>
                            </thead>
                            <tbody id="inventory-table-body">
                                <!-- Inventory display will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Trading Section -->
        <section id="trading" class="section">
            <div class="section-header">
                <h2>Gem Trading</h2>
                <p>Trade your gems in different cities and unlock trading benefits</p>
            </div>

            <div class="trading-container">
                <!-- Trading Benefits Overview -->
                <div class="benefits-overview">
                    <h3><i class="fas fa-star"></i> Active Benefits</h3>
                    <div id="benefits-display">
                        <!-- Benefits display will be populated by JavaScript -->
                    </div>
                </div>
                
                <div class="trading-overview">
                    <div class="trading-stats">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-city"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Active City</h3>
                                <p class="stat-value" id="active-city">Select City</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Trading Bonus</h3>
                                <p class="stat-value" id="trading-bonus">0%</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-dollar-sign"></i>
                            </div>
                            <div class="stat-content">
                                <h3>Game Dollars</h3>
                                <p class="stat-value" id="game-dollars">0$</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="trading-panel">
                    <div class="trading-menu">
                        <h3><i class="fas fa-shopping-cart"></i> Sell Gems</h3>
                        <div class="city-selection">
                            <label for="city-select">Choose City:</label>
                            <select id="city-select" onchange="game.changeTradingCity()">
                                <option value="newyork">New York (+5% bonus)</option>
                                <option value="london">London (+8% bonus)</option>
                                <option value="tokyo">Tokyo (+10% bonus)</option>
                                <option value="dubai">Dubai (+15% bonus)</option>
                                <option value="geneva">Geneva (+20% bonus)</option>
                            </select>
                        </div>
                        <div class="sell-section">
                            <div id="gem-selling-grid" class="gem-selling-grid">
                                <!-- Gem selling options will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>

                    <div class="staking-benefits">
                        <div class="section-title">
                            <h3><i class="fas fa-gem"></i> Gem Staking</h3>
                            <p>Stake gems to unlock increased selling prices</p>
                        </div>
                        <div class="staking-grid" id="staking-grid">
                            <!-- Staking slots will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Modals -->
    <div id="modal-overlay" class="modal-overlay">
        <div class="modal" id="modal">
            <div class="modal-header">
                <h3 id="modal-title">Modal Title</h3>
                <button class="modal-close" onclick="closeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Modal content -->
            </div>
        </div>
    </div>

    <!-- Equipment Repair Modal -->
    <div id="repair-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3>Repair Equipment</h3>
                <button class="modal-close" onclick="closeRepairModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="repair-content">
                    <!-- Repair content -->
                </div>
            </div>
        </div>
    </div>

    <!-- Worker Motivation Modal -->
    <div id="motivation-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3>Motivate Worker</h3>
                <button class="modal-close" onclick="closeMotivationModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="motivation-content">
                    <!-- Motivation content -->
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications -->
    <div id="notifications" class="notifications"></div>

    <!-- Mining Animations Container -->
    <div id="mining-animations" class="mining-animations"></div>
    <script>
    (() => {
    const $ = (s, r=document) => r.querySelector(s);
    const connectBtn   = $('#connect-wallet');
    const disconnectBtn= $('#disconnect-wallet');
    const walletModal  = $('#wallet-modal');
    const walletError  = $('#wallet-error');

    connectBtn?.addEventListener('click', () => {
        walletError?.classList.add('hidden');
        walletModal?.classList.remove('hidden');
        walletModal?.setAttribute('aria-hidden','false');
    });

    document.addEventListener('click', (e) => {
        if (e.target.matches('[data-close-wallet-modal]') || e.target === walletModal) {
        walletModal?.classList.add('hidden');
        walletModal?.setAttribute('aria-hidden','true');
        }
    });

    document.addEventListener('click', (e) => {
        const btn = e.target.closest('[data-provider]');
        if (!btn) return;
        const provider = btn.getAttribute('data-provider');
        window.dispatchEvent(new CustomEvent('tsd:wallet:connect', { detail: { provider } }));
    });

    disconnectBtn?.addEventListener('click', () => {
        window.dispatchEvent(new Event('tsd:wallet:disconnect'));
    });
    })();
    </script>

    <!-- Your main wallet logic -->
    <script type="module" src="wallet.js"></script>
    <script src="script.js"></script>
</body>
</html>