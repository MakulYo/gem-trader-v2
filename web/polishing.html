<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TSDGEMS - Gem Polishing</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
      .hidden { display: none !important; }
      #nav-wallet[data-auth="signed-out"] #wallet-balance { display: none !important; }
    </style>
</head>
<body>
<script>
  // Load cached Game $ value immediately to prevent flash
  const cachedValue = localStorage.getItem('tsdgems_game_dollars');
  if (cachedValue && parseFloat(cachedValue) > 0) {
    // Wait for DOM ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function() {
        const header = document.getElementById('header-game-dollars');
        if (header) header.textContent = 'Game $: ' + parseFloat(cachedValue).toLocaleString();
      });
    } else {
      const header = document.getElementById('header-game-dollars');
      if (header) header.textContent = 'Game $: ' + parseFloat(cachedValue).toLocaleString();
    }
  }
</script>
<style>
      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
      }
      
      .polishing-slot.active.in-progress {
        animation: glow-orange 2s ease-in-out infinite;
      }
      
      .polishing-slot.active.complete {
        animation: glow-green 1.5s ease-in-out infinite;
      }
      
      @keyframes glow-orange {
        0%, 100% { box-shadow: 0 0 20px rgba(255, 149, 0, 0.3); }
        50% { box-shadow: 0 0 30px rgba(255, 149, 0, 0.6); }
      }
      
      @keyframes glow-green {
        0%, 100% { box-shadow: 0 0 20px rgba(0, 255, 100, 0.3); }
        50% { box-shadow: 0 0 35px rgba(0, 255, 100, 0.7); }
      }
      
      .nft-card:hover {
        transform: translateY(-5px);
        border-color: #00ff64 !important;
        box-shadow: 0 5px 20px rgba(255, 149, 0, 0.4);
      }
      
      .modal-overlay.active {
        display: flex !important;
        align-items: center;
        justify-content: center;
      }
      
      .gem-selection-card:hover:not(.disabled) {
        transform: translateY(-3px);
        border-color: #00ff64 !important;
        box-shadow: 0 4px 15px rgba(255, 149, 0, 0.4);
      }
      
      .gem-selection-card.disabled {
        cursor: not-allowed !important;
      }
    </style>
</head>
<body>
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-left-group">
        <div class="nav-logo">
          <i class="fas fa-gem"></i>
          <span>TSDGEMS</span>
        </div>
        <span class="nav-game-dollar" id="header-game-dollars">Game $: 0</span>
        <button class="mobile-menu-toggle" id="mobile-menu-toggle">
          <i class="fas fa-bars"></i>
        </button>
      </div>
        
      <div class="nav-menu" id="nav-menu">
        <a href="index.html" class="nav-link">Dashboard</a>
        <a href="mining.html" class="nav-link">Mining</a>
        <a href="polishing.html" class="nav-link active">Polishing</a>
        <a href="trading.html" class="nav-link">Trading</a>
        <a href="inventory.html" class="nav-link">Inventory</a>
        <a href="leaderboard.html" class="nav-link">Leaderboard</a>
        <a href="shop.html" class="nav-link">Shop</a>
      </div>

      <div class="nav-wallet" id="nav-wallet" data-auth="signed-out">
        <button id="connectWalletBtn" class="connect-wallet-btn" data-action="connect">Connect Wallet</button>

        <span id="walletStatus" class="wallet-status hidden" style="margin-right:.75rem;color:#a0d9ff;"></span>
        <span id="wallet-address" class="wallet-address hidden"></span>
        <span id="wallet-balance" class="wallet-balance hidden" data-token="TSD">0.00 TSD</span>

        <button id="logoutBtn" class="connect-wallet-btn hidden" data-action="disconnect">Disconnect</button>
      </div>
    </div>
  </nav>

  <div class="scale-wrapper">
    <main class="main-content">
      <section id="polishing" class="section active">
        <div class="section-header">
          <h2>Gem Polishing</h2>
          <p>Stake polishing table NFTs and polish gems in automated slots</p>
        </div>

        <div class="polishing-container">
          <div class="polishing-overview">
            <div class="polishing-stats">
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-gem"></i>
                </div>
                <div class="stat-content">
                  <h3>Rough Gems Available</h3>
                  <p class="stat-value" id="rough-gems-polishing-count">0</p>
                </div>
              </div>
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-gem" style="color: #00d4ff; text-shadow: 0 0 10px #00d4ff;"></i>
                </div>
                <div class="stat-content">
                  <h3>Polished Gems Created</h3>
                  <p class="stat-value" id="polished-gems-polishing-count">0</p>
                </div>
              </div>
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-table"></i>
                </div>
                <div class="stat-content">
                  <h3>Polishing Tables</h3>
                  <p class="stat-value" id="polishing-tables-count">0</p>
                </div>
              </div>
            </div>
          </div>
          
          <div class="polishing-slots">
            <div class="section-title">
              <h3><i class="fas fa-table"></i> Polishing Slot System</h3>
              <p>Stake Polishing Table NFTs in slots and polish gems automatically</p>
            </div>
            
            <div class="slots-grid" id="polishing-slots-grid">
              <!-- Polishing slots will be populated by JavaScript -->
            </div>
          </div>

          <div class="polished-gems-distribution" style="margin-top: 40px;">
            <div class="section-title">
              <h3><i class="fas fa-gem"></i> Polished Gem Types & Drop Chances</h3>
              <p>When polishing rough gems, you'll receive one of these polished gem types based on RNG</p>
            </div>
            
            <div class="distribution-table">
              <table class="gem-distribution-table" style="width: 100%; margin-top: 20px;">
                <thead>
                  <tr>
                    <th style="text-align: left; padding: 12px; border-bottom: 2px solid rgba(255, 149, 0, 0.3);">Polished Gem Type</th>
                    <th style="text-align: center; padding: 12px; border-bottom: 2px solid rgba(255, 149, 0, 0.3);">Drop Chance</th>
                    <th style="text-align: center; padding: 12px; border-bottom: 2px solid rgba(255, 149, 0, 0.3);">Rarity</th>
                    <th style="text-align: right; padding: 12px; border-bottom: 2px solid rgba(255, 149, 0, 0.3);">You Own</th>
                  </tr>
                </thead>
                <tbody id="polished-gems-table-body">
                  <!-- Will be populated by JavaScript -->
                </tbody>
              </table>
            </div>
          </div>

          <div class="polishing-info" style="margin-top: 30px; padding: 25px; background: rgba(0, 212, 255, 0.05); border: 2px solid rgba(0, 212, 255, 0.2); border-radius: 12px;">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
              <div style="padding: 15px; background: rgba(0, 0, 0, 0.3); border-radius: 8px;">
                <h4 style="color: #ff9500; margin-bottom: 8px; font-size: 1em;">
                  <i class="fas fa-table"></i> 1. Stake Tables
                </h4>
                <p style="color: #888; font-size: 0.85em; margin: 0;">
                  Each Polishing Table NFT unlocks 1 polishing slot. Stake them to activate slots.
                </p>
              </div>
              <div style="padding: 15px; background: rgba(0, 0, 0, 0.3); border-radius: 8px;">
                <h4 style="color: #ff9500; margin-bottom: 8px; font-size: 1em;">
                  <i class="fas fa-play"></i> 2. Start Polishing
                </h4>
                <p style="color: #888; font-size: 0.85em; margin: 0;">
                  Select amount (max 500 per slot) and start. Polishing takes 1 hour.
                </p>
              </div>
              <div style="padding: 15px; background: rgba(0, 0, 0, 0.3); border-radius: 8px;">
                <h4 style="color: #ff9500; margin-bottom: 8px; font-size: 1em;">
                  <i class="fas fa-gift"></i> 3. Claim Rewards
                </h4>
                <p style="color: #888; font-size: 0.85em; margin: 0;">
                  Receive random polished gem type (1:1 conversion).
                </p>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <div id="notifications" class="notifications"></div>

    <!-- Modal -->
    <div id="modal-overlay" class="modal-overlay">
      <div class="modal" id="modal">
        <div class="modal-header">
          <h3 id="modal-title">Modal Title</h3>
          <button class="modal-close" onclick="game.closeStakeModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body" id="modal-body"></div>
      </div>
    </div>

    <script src="backend-service.js"></script>
    <script src="skeleton.js"></script>
    <script src="common.js"></script>
    <script type="module" src="wallet.js"></script>
    <script src="payment-service.js"></script>
    <script src="polishing.js"></script>
  </div>
</body>
</html>
