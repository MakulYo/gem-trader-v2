<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TSDGEMS - Diamond Trading Simulator</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
      .hidden { display: none !important; }
      #nav-wallet[data-auth="signed-out"] #wallet-balance { display: none !important; }
      .gallery-category { margin-bottom: 2.5rem; }
    </style>
</head>
<body>
  <div class="scale-wrapper">
    <!-- Navigation -->
    <nav class="navbar">
      <div class="nav-container">
        <div class="nav-logo">
          <i class="fas fa-gem"></i>
          <span>TSDGEMS</span>
        </div>

        <div class="nav-status-group">
          <span class="nav-game-dollar" id="header-game-dollars">Game $: 0</span>
        </div>
        
        <!-- Mobile Menu Toggle -->
        <button class="mobile-menu-toggle" id="mobile-menu-toggle">
          <i class="fas fa-bars"></i>
        </button>
        
        <div class="nav-menu" id="nav-menu">
          <a href="#dashboard" class="nav-link active">Dashboard</a>
          <a href="#mining" class="nav-link">Mining</a>
          <a href="#polishing" class="nav-link">Polishing</a>
          <a href="#trading" class="nav-link">Trading</a>
          <a href="#leaderboard" class="nav-link">Leaderboard</a>
          <a href="#gallery" class="nav-link">Shop</a>
        </div>

        <!-- Wallet UI -->
        <div class="nav-wallet" id="nav-wallet" data-auth="signed-out">
          <span id="wallet-address" class="wallet-address hidden" title="Wallet address"></span>
          <span id="wallet-balance" class="wallet-balance hidden" data-token="TSD">0.00 TSD</span>

          <!-- CHANGED: id to match wallet.js -->
          <button id="connectWalletBtn" class="connect-wallet-btn" data-action="connect">
            Connect Wallet
          </button>

          <!-- CHANGED: id to match wallet.js -->
          <button id="logoutBtn" class="connect-wallet-btn hidden" data-action="disconnect">
            Disconnect
          </button>

          <!-- NEW: minimal status line used by wallet.js -->
          <span id="walletStatus" style="margin-left:.75rem;color:#a0d9ff;"></span>
        </div>

        <!-- Your custom Choose Wallet Modal (kept but not used by WharfKit UI) -->
        <div id="wallet-modal" class="modal-overlay hidden" aria-hidden="true">
          <div class="modal">
            <div class="modal-header">
              <h3>Connect Wallet</h3>
              <button class="modal-close" data-close-wallet-modal>
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div class="modal-body">
              <div class="wallet-grid">
                <button class="action-btn primary" data-provider="cloud">
                  <i class="fas fa-cloud"></i> WAX Cloud Wallet
                </button>
                <button class="action-btn secondary" data-provider="anchor">
                  <i class="fas fa-anchor"></i> Anchor
                </button>
                <button class="action-btn tertiary" data-provider="wombat" disabled title="Coming soon">
                  <i class="fas fa-paw"></i> Wombat (coming soon)
                </button>
              </div>
              <p id="wallet-error" class="text-danger hidden"></p>
            </div>
          </div>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Dashboard Section -->
      <section id="dashboard" class="section active">
        <div class="dashboard-header">
          <h1>Welcome to TSDGEMS</h1>
          <p>The ultimate blockchain-based diamond trading simulator</p>
        </div>
        
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-coins"></i>
            </div>
            <div class="stat-content">
              <h3>Ingame $</h3>
              <p class="stat-value" id="tsd-balance">0.00</p>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-users"></i>
            </div>
            <div class="stat-content">
              <h3>Hired Workers</h3>
              <p class="stat-value" id="active-workers">0</p>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-gem"></i>
            </div>
            <div class="stat-content">
              <h3>Rough Gems</h3>
              <p class="stat-value" id="rough-gems-count">0</p>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-gem" style="color: #00d4ff; text-shadow: 0 0 10px #00d4ff;"></i>
            </div>
            <div class="stat-content">
              <h3>Polished Gems</h3>
              <p class="stat-value" id="polished-gems-count">0</p>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-map-marker-alt"></i>
            </div>
            <div class="stat-content">
              <h3>Mining Slots</h3>
              <p class="stat-value" id="mining-slots-count">0/10</p>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-wallet"></i>
            </div>
            <div class="stat-content">
              <h3>TSDM Balance</h3>
              <p class="stat-value" id="tsdm-balance">0.00</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Mining Section -->
      <section id="mining" class="section">
        <div class="section-header">
          <h2>Mining Operations</h2>
          <p>Manage your mining infrastructure and equipment</p>
        </div>

        <div class="mining-container">
          <div class="mining-slots-grid">
            <div class="mining-overview">
              <div class="mining-stats">
                <div class="stat-card">
                  <div class="stat-icon">
                    <i class="fas fa-mountain"></i>
                  </div>
                  <div class="stat-content">
                    <h3>Active Mining Sites</h3>
                    <p class="stat-value" id="active-mining-sites">0</p>
                  </div>
                </div>
                <div class="stat-card">
                  <div class="stat-icon">
                    <i class="fas fa-users"></i>
                  </div>
                  <div class="stat-content">
                    <h3>Workforce</h3>
                    <p class="stat-value" id="total-workforce">0</p>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="mining-slots-section">
              <div class="section-title">
                <h3><i class="fas fa-gem"></i> Mining Properties</h3>
                <p>Discover, acquire, and develop profitable mining locations</p>
              </div>
              <div class="slots-grid" id="slots-grid">
                <!-- Mining slots will be populated by JavaScript -->
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Polishing Section -->
      <section id="polishing" class="section">
        <div class="section-header">
          <h2>Gem Polishing</h2>
          <p>Stake polishing table NFTs and polish gems in automated slots</p>
        </div>

        <div class="polishing-container">
          <div class="polishing-overview">
            <div class="polishing-stats">
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-gem"></i>
                </div>
                <div class="stat-content">
                  <h3>Rough Gems Available</h3>
                  <p class="stat-value" id="rough-gems-polishing-count">0</p>
                </div>
              </div>
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-gem" style="color: #00d4ff; text-shadow: 0 0 10px #00d4ff;"></i>
                </div>
                <div class="stat-content">
                  <h3>Polished Gems Created</h3>
                  <p class="stat-value" id="polished-gems-polishing-count">0</p>
                </div>
              </div>
              <div class="stat-card">
                <div class="stat-icon">
                  <i class="fas fa-box"></i>
                </div>
                <div class="stat-content">
                  <h3>Total Gem Inventory</h3>
                  <p class="stat-value" id="total-inventory-gems">0</p>
                </div>
              </div>
            </div>
          </div>
          
          <div class="polishing-slots">
            <div class="section-title">
              <h3><i class="fas fa-table"></i> Polishing Slot System</h3>
              <p>Stake Polishing Table NFTs in slots and polish gems automatically</p>
            </div>
            
            <div class="slots-grid" id="polishing-slots-grid">
              <!-- Polishing slots will be populated by JavaScript -->
            </div>
          </div>

          <div class="gem-inventory" id="gem-inventory">
            <div class="section-title">
              <h3><i class="fas fa-gem"></i> Gem Distribution Table</h3>
              <p>Chance distribution for obtaining gems through polishing</p>
            </div>
            
            <div class="distribution-table">
              <table class="gem-distribution-table">
                <thead>
                  <tr>
                    <th>Gem Type</th>
                    <th>Chance</th>
                    <th>Owned</th>
                    <th>Rarity</th>
                  </tr>
                </thead>
                <tbody id="inventory-table-body">
                  <!-- Inventory display will be populated by JavaScript -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- Trading Section -->
      <section id="trading" class="section">
        <div class="section-header">
          <h2>Gem Trading</h2>
          <p>Trade your gems in different cities and unlock trading benefits</p>
          <div class="trading-subpage-toggle" id="trading-subpage-toggle">
            <button class="toggle-btn active" data-target="overview">Trading Overview</button>
            <button class="toggle-btn" data-target="staking">Gem Staking</button>
            <button class="toggle-btn" data-target="pricing">Gem Base Prices</button>
          </div>
        </div>

        <div id="trading-subpage-overview" class="trading-subpage active">
          <div class="city-boost-container" id="city-boost">
            <div class="section-title">
              <h3>
                <i class="fas fa-bolt"></i> City Boost Data Matrix
                <span class="base-price-chip" id="matrix-base-price">Base price: loading…</span>
              </h3>
              <p>Analyse the hourly trading boost values across global trading hubs.</p>
            </div>
            <div class="matrix-sell-controls">
              <div class="matrix-control">
                <label for="matrix-city-select">City</label>
                <select id="matrix-city-select"></select>
              </div>
              <div class="matrix-control">
                <label for="matrix-gem-select">Gem Type</label>
                <select id="matrix-gem-select"></select>
              </div>
              <div class="matrix-control">
                <label for="matrix-sell-amount">Amount</label>
                <input type="number" id="matrix-sell-amount" min="1" value="1">
              </div>
              <div class="matrix-control action">
                <label>&nbsp;</label>
                <button id="matrix-sell-btn" class="action-btn primary">
                  <i class="fas fa-coins"></i> Sell Gems
                </button>
              </div>
            </div>
            <div class="matrix-summary" id="matrix-summary">
              <span id="matrix-summary-boost">Boost: +0%</span>
              <span id="matrix-summary-staking">Staking Bonus: +0%</span>
              <span id="matrix-summary-price">Est. Payout: 0 Game $</span>
            </div>
            <div id="city-boost-matrix-wrapper"></div>
          </div>

          <div class="trading-container">
            <!-- Trading Benefits Overview -->
            <div class="benefits-overview">
              <h3><i class="fas fa-star"></i> Active Benefits</h3>
              <div id="benefits-display">
                <!-- Benefits display will be populated by JavaScript -->
              </div>
            </div>
            <div class="trading-panel">
              <!-- Trading panel content -->
            </div>
          </div>
        </div>

        <div id="trading-subpage-staking" class="trading-subpage">
          <div class="staking-benefits">
            <div class="section-title">
              <h3><i class="fas fa-gem"></i> Gem Staking</h3>
              <p>Stake gems to unlock increased selling prices</p>
            </div>
            <div class="staking-grid" id="staking-grid">
              <!-- Staking slots will be populated by JavaScript -->
            </div>
          </div>
        </div>

        <div id="trading-subpage-pricing" class="trading-subpage">
          <div class="pricing-container">
            <div class="section-title">
              <h3><i class="fas fa-chart-area"></i> Gem Base Price Chart</h3>
              <p>Live gem base price derived from BTC market data.</p>
            </div>
            <div class="pricing-status" id="pricing-status">Loading latest prices…</div>
            <div class="pricing-chart-wrapper">
              <canvas id="gem-price-chart"></canvas>
            </div>
          </div>
        </div>
      </section>

      <!-- Leaderboard Section -->
      <section id="leaderboard" class="section">
        <div class="section-header">
          <h2>Top Tycoons</h2>
          <p>The wealthiest traders in the game – ranked by in-game dollars.</p>
        </div>

        <div class="leaderboard-container">
          <div class="leaderboard-table">
            <div class="table-header">
              <div class="header-cell">Rank</div>
              <div class="header-cell">Player</div>
              <div class="header-cell">In-game $</div>
            </div>
            <div class="table-body" id="leaderboard-body"></div>
            <div class="leaderboard-pagination">
              <div class="page-info" id="leaderboard-page-info">Showing 1-15 of 20 entries</div>
              <div class="page-controls">
                <button type="button" id="leaderboard-prev" disabled>
                  <i class="fas fa-angle-left"></i>
                </button>
                <span id="leaderboard-page-summary">Page 1 of 1</span>
                <button type="button" id="leaderboard-next">
                  <i class="fas fa-angle-right"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Shop Section -->
      <section id="gallery" class="section">
        <div class="section-header">
          <h2>TSDGEMS Shop</h2>
          <p>Discover curated TSDGEMS NFTs and secure your favorite assets on NeftyBlocks.</p>
          <div class="shop-actions">
            <a class="action-btn primary" href="https://neftyblocks.com/collection/tsdmediagems" target="_blank" rel="noopener">
              <i class="fas fa-shopping-cart"></i> Buy NFTs
            </a>
          </div>
        </div>
        <div class="gallery-category">
          <div class="section-title">
            <h3><i class="fas fa-gem" style="color: #00d4ff; text-shadow: 0 0 10px #00d4ff;"></i> Polished Gems</h3>
            <p>The final, beautifully polished gemstones ready for collection.</p>
          </div>
          <div class="gallery-grid">
            <!-- (gallery cards unchanged) -->
            <!-- ... -->
          </div>
        </div>

        <div class="gallery-category">
          <div class="section-title">
            <h3><i class="fas fa-gem"></i> Unpolished Gems</h3>
            <p>Raw, uncut gemstones ready to be polished into masterpieces.</p>
          </div>
          <div class="gallery-grid">
            <!-- (gallery cards unchanged) -->
            <!-- ... -->
          </div>
        </div>

        <div class="gallery-category">
          <div class="section-title">
            <h3><i class="fas fa-industry"></i> Mining Equipment</h3>
            <p>Essential tools and machinery for your mining operations.</p>
          </div>
          <div class="gallery-grid">
            <!-- (gallery cards unchanged) -->
            <!-- ... -->
          </div>
        </div>

        <div class="gallery-category">
          <div class="section-title">
            <h3><i class="fas fa-tools"></i> Polishing Tools</h3>
            <p>The essential tool to transform rough gems into polished masterpieces.</p>
          </div>
          <div class="gallery-grid">
            <!-- (gallery cards unchanged) -->
            <!-- ... -->
          </div>
        </div>

        <div class="gallery-category">
          <div class="section-title">
            <h3><i class="fas fa-shapes"></i> Shards</h3>
            <p>The unfortunate result when gems break during polishing (10% chance).</p>
          </div>
          <div class="gallery-grid">
            <!-- (gallery cards unchanged) -->
            <!-- ... -->
          </div>
        </div>
      </section>
    </main>

    <!-- Modals -->
    <div id="modal-overlay" class="modal-overlay">
      <div class="modal" id="modal">
        <div class="modal-header">
          <h3 id="modal-title">Modal Title</h3>
          <button class="modal-close" onclick="closeModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body" id="modal-body">
          <!-- Modal content -->
        </div>
      </div>
    </div>

    <!-- Equipment Repair Modal -->
    <div id="repair-modal" class="modal-overlay">
      <div class="modal">
        <div class="modal-header">
          <h3>Repair Equipment</h3>
          <button class="modal-close" onclick="closeRepairModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div id="repair-content">
            <!-- Repair content -->
          </div>
        </div>
      </div>
    </div>

    <!-- Worker Motivation Modal -->
    <div id="motivation-modal" class="modal-overlay">
      <div class="modal">
        <div class="modal-header">
          <h3>Motivate Worker</h3>
          <button class="modal-close" onclick="closeMotivationModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div id="motivation-content">
            <!-- Motivation content -->
          </div>
        </div>
      </div>
    </div>

    <!-- Worker Selection Gallery Modal -->
    <div id="worker-gallery-modal" class="modal-overlay">
      <div class="modal worker-gallery-modal">
        <div class="modal-header">
          <h3>Select Workers</h3>
          <div class="worker-selection-info">
            <span id="selected-workers-count">0</span>/<span id="max-workers-count">0</span> selected
          </div>
          <button class="modal-close" onclick="closeWorkerGalleryModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="modal-body">
          <div class="worker-gallery-container">
            <div class="worker-gallery-grid" id="worker-gallery-grid">
              <!-- Worker images will be populated by JavaScript -->
            </div>
          </div>
          <div class="worker-gallery-actions">
            <button id="confirm-worker-selection" class="action-btn primary" disabled>
              <i class="fas fa-check"></i> Confirm Selection (100 TSDM each)
            </button>
            <button onclick="closeWorkerGalleryModal()" class="action-btn secondary">
              <i class="fas fa-times"></i> Cancel
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Notifications -->
    <div id="notifications" class="notifications"></div>

    <!-- Mining Animations Container -->
    <div id="mining-animations" class="mining-animations"></div>

    <!-- WharfKit wallet logic (already created in wallet.js) -->
    <script type="module" src="wallet.js"></script>

    <!-- Other app scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <script src="script.js"></script>
  </div>
</body>
</html>
